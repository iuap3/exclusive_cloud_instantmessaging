## IM集成常见问题

### Q：IM中的租户结构是什么样的？

A：IM中一个租户代表一个公司、部门或组织结构，IM中以etpId作为标识。每个租户下可以建立一到多个应用，IM中以appId标识，
   每个应用下会有多个用户、群组、公共账号。IM中的业务都是以应用隔离的。用户是IM中最基本的组成单位，一个IM用户的完整
   用户名是由自定义用户名+应用ID+企业ID组成，每个用户只能属于一个企业下的一个应用。
   比如：租户“用友”，etpId为yonyou，该租户下有三个应用，分别为:
   “开发应用”，appId为yonyou_dev;
   “预发布应用”，appId为yonyou_pre;
   “正式应用”，appId为yonyou_pro;
   对于下面三个用户分别属于三个应用下的用户：
   zongtf.yonyou_dev.yonyou	属于应用yonyou_dev
   zongtf.yonyou_pre.yonyou 属于应用yonyou_pre
   zongtf.yonyou_pro.yonyou 属于应用yonyou_pro
   这三个用户没有任何关联关系，对于群组和公共号也一样。

### Q：token是什么？

A：token是IM用于验证用户身份的一种方式，IM中token主要用于登录时验证身份和使用IM短连接接口时进行身份验证。

### Q：token分为几类？各有什么作用？

A：IM中token分为用户token和apptoken，用户token用来验证对应的用户身份，每个用户对应一个usertoken。apptoken是用来验证应用的身份，每个应用对应一个apptoken。
   usertoken除了用来登录时验证用户身份之外，在调用IM服务端短连接某些接口时也需要该token。
   apptoken主要用于调用IM服务端接口时进行验证。
   注：IM服务端接口有些是需要验证usertoken，有些是验证apptoken。

### Q：token如何获取？有效期是多长时间？

A：token的获取通过IM获取token的接口来实现，对于usertoken，需要传入应用对应的clientId和clientSecret以及用户的username。
   对于apptoken只需要传入应用对应的ClientIdentify和clientSecret即可。接口会对clientID和clientSecret以及接口url中指定
   的etpId和appId进行验证，验证通过后会返回token的值以及一个时间戳expiration。expiration表示该token对应的过期时间。
   token的过期机制是：初次获取的token的有效期是24小时，当在token剩余有效期在12小时之内再次调用接口获取时，服务端会重置
   token的有效期到24小时，剩余有效期时间超过12小时不会重置有效期。举个例子：今天早上8点调用接口返回的token是：1234，过期时间是明天早上8点，如果在今天晚上8点之前再次调用接口则有效期还是在明天早上8点，如果在晚上8点之后，比如晚上9点调用
   接口获取，则该token的有效期会变成明天晚上9点（重置成获取时间开始的24小时）。

### Q：该如何将IM集成到自己的APP中？ 

A：集成IM到自己的APP中非常简单，首先在IM官网上下载对应系统的sdk(目前支持ios，android,web),按照sdk中的集成指南进行集成。
   集成IM时，获取token不建议直接让APP和IM服务器交互，而是通过APP和自己的AppServer进行交互，通过AppServer向IM服务器获取
   token，这样的好处是避免clientId和clientSecret放在APP端而造成泄露。

### Q：如何定制符合自己业务的消息通知？

A：IM消息包含了一个扩展字段，用户可以根据自己的业务在扩展字段中自由放入自己的业务数据，只需端上做简单的适配，即可实现消息自定义展
   示，点击跳转等功能。IM服务端提供了使用公共账号发送消息给指定人员的接口，用户可以根据自己的业务需要在特定的场景调用该接口给指定
   的用户发送通知消息，常见的场景如：审批提醒，动态提醒，邮件提醒等等。

### Q:创建应用时如何选择应用的模式？

A：有信IM提供三种模式供选择
	授权模式：有信IM不对用户的密码进行校验，由APP服务器负责，用户需要提前导入到IM系统中，用户不存在的情况下不会自动创建用户。
	托管模式：有信IM会验证用户的密码，用户需要提前导入到有信IM系统中，用户不存在的情况下不会自动创建用户。
	开放模式：有信IM不验证用户密码，由APP服务器负责，用户无需提前导入到有信IM系统中，用户不存在的情况下首次获取token会自动创建对应用户。
开放模式是使用最多的一种模式，获取用户token的接口支持传入nickname和photo参数，有信服务器会使用对应的参数创建用户，从而避免了需要提前导入用户。

### Q：如何使用IM服务端的接口文档？

A：IM官网上有对应的IM服务端部分接口文档，接口文档用于APPServer和IM服务器交互使用，举一个常见的使用场景：用户的APP需要实现审批提醒的功能，在集成了有信IM的情况下，当用户在APP内提交一个申请的时候，对应的APPServer获取该申请相关的信息，然后调用IM的“公共账号发消息给指定人员”接口，发送自定义内容的消息给被提醒用户。其他的接口文档使用场景也类似。服务端接口不建议直接在客户端使用。如果在文档中没有找到满足需求的文档，可以联系IM相关人员询问是否有对应的文档，如果没有可以根据需要新增。
   